/*!
 * jQuery Plugin for scrollbars
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(t){t.fn.scroll2=function(i){var o,e,n,a,r,c,s,l,h=t(this),d=0,g=0,p={},u={},f={},m={},v=t.extend(!0,{size:7,railColor:"#aaa",barColor:"#000",timeout:1e3,container:{width:"",height:""},appendTo:void 0,vertical:{active:!0,margin:2,top:0,bottom:0,trigger:{callback:void 0,offset:0}},horizontal:{active:!0,margin:2,left:0,right:0,trigger:{callback:void 0,offset:0}}},i),b=function(){p.throttle=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-p.throttle>=500&&w()},500)},w=function(){"function"==typeof v.container.width?o.width(v.container.width()):v.container.width&&o.width(v.container.width),"function"==typeof v.container.height?o.height(v.container.height()):v.container.height&&o.height(v.container.height);var t=o.height()/h.height(),i=o.width()/h.width();r.height(Math.floor(100*t)+"%"),s.width(Math.floor(100*i)+"%"),window.setTimeout(function(){r.height(r.height()||2*v.size),s.width(s.width()||2*v.size)},200),h.height()<=o.height()||!v.vertical.active?(r.hide(),a.hide()):(r.show(),a.show()),h.width()<=o.width()||!v.horizontal.active?(s.hide(),c.hide()):(s.show(),c.show())},z=function(){window.MutationObserver?l.disconnect():h.unbind("DOMSubtreeModified",b),t(window).unbind("resize",b),t(document).unbind("mouseup",X),v.appendTo&&t(v.appendTo).unbind("mousemove",E),h.remove(),e.append(h),o.remove()},x=function(t,i,o,e){("mousemove"!==i.type||i.pageX!==u[o]||i.pageY!==f[o])&&(u[o]=i.pageX,f[o]=i.pageY,t.addClass("active"),p[o]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-p[o]>=v.timeout&&(t.removeClass("active"),"function"==typeof e&&e())},v.timeout))},y=function(t,i){"horizontal"===i?(s.height(v.size+3),s.css("bottom",v.horizontal.margin+2+"px"),x(c,t,i+"rail",function(){s.css("bottom",v.horizontal.margin+"px"),s.height(v.size)})):(r.width(v.size+3),r.css("right",v.vertical.margin+2+"px"),x(a,t,i+"rail",function(){r.css("right",v.vertical.margin+"px"),r.width(v.size)}))},T=function(t){x(r,t,"verticalbar"),x(s,t,"horizontalbar")},k=function(t,i){T(t),y(t,i)},C=function(t){if(0>g?g=0:g>h.height()-o.height()&&(g=h.height()-o.height()),0>d?d=0:d>h.width()-o.width()&&(d=h.width()-o.width()),n.scrollTop()!==g||n.scrollLeft()!==d){if(r.css("top",o.height()*g/h.height()+"px"),s.css("left",o.width()*d/h.width()+"px"),s.is(":visible")&&(n.scrollLeft(d),"function"==typeof v.horizontal.trigger.callback)){var i=n[0].scrollWidth-o.width();i-d<=v.horizontal.trigger.offset&&v.horizontal.trigger.callback()}if(r.is(":visible")&&(n.scrollTop(g),"function"==typeof v.vertical.trigger.callback)){var i=n[0].scrollHeight-o.height();i-g<=v.vertical.trigger.offset&&v.vertical.trigger.callback()}t.stopPropagation()}},D=function(t){"touchmove"===t.type?(u.touch&&f.touch&&(d-=t.originalEvent.touches[0].pageX-u.touch,g-=t.originalEvent.touches[0].pageY-f.touch),u.touch=t.originalEvent.touches[0].pageX,f.touch=t.originalEvent.touches[0].pageY):(d+=t.originalEvent.deltaX||0,g+=t.originalEvent.deltaY||0),C(t)},M=function(i,o){t(document.body).addClass("scroll2-noselect"),m[o]=!0},X=function(){t(document.body).removeClass("scroll2-noselect"),m={}},Y=function(t,i){"horizontal"===i?t.pageX-s.offset().left>0?d+=o.width():d-=o.width():t.pageY-r.offset().top>0?g+=o.height():g-=o.height(),C(t)},E=function(t){m.vertical&&f.drag?g+=h.height()*(t.pageY-f.drag)/o.height():m.horizontal&&u.drag&&(d+=h.width()*(t.pageX-u.drag)/o.width()),m.vertical||m.horizontal?(C(t),u.drag=t.pageX,f.drag=t.pageY):(u.drag=void 0,f.drag=void 0)},O=function(){if(e=h.parent(),o=t('<div class="scroll2"/>'),n=t('<div class="scroll2-content"/>'),o.bind("mousewheel touchmove wheel mousemove",function(t){T(t),"mousemove"!==t.type?D(t):t.stopPropagation()}),a=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),a.width(v.size+7),a.css("background-color",v.railColor),a.css("top","0"),a.css("right",v.vertical.margin+"px"),a.css("bottom","0"),a.css("margin-top",v.vertical.top+"px"),a.css("margin-bottom",v.vertical.bottom+"px"),r=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),r.width(v.size),r.css("border-radius",v.size+"px"),r.css("background-color",v.barColor),r.css("top","0"),r.css("right",v.vertical.margin+"px"),r.css("margin-top",v.vertical.top+"px"),r.css("margin-bottom",v.vertical.bottom+"px"),c=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),c.height(v.size+7),c.css("background-color",v.railColor),c.css("left","0"),c.css("bottom",v.horizontal.margin+"px"),c.css("right","0"),c.css("margin-left",v.horizontal.left+"px"),c.css("margin-right",v.horizontal.right+"px"),s=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),s.height(v.size),s.css("border-radius",v.size+"px"),s.css("background-color",v.barColor),s.css("left","0"),s.css("bottom",v.horizontal.margin+"px"),s.css("margin-left",v.horizontal.left+"px"),s.css("margin-right",v.horizontal.right+"px"),t(document).bind("mouseup",X),v.appendTo?t(v.appendTo).bind("mousemove",E):o.bind("mousemove",E),r.bind("mousemove",function(t){k(t,"vertical")}),r.bind("mousedown",function(t){M(t,"vertical")}),r.bind("dragstart",function(t){t.preventDefault()}),a.bind("mousemove",function(t){k(t,"vertical")}),a.bind("click",function(t){k(t,"vertical")}),a.bind("click",function(t){Y(t,"vertical")}),s.bind("mousemove",function(t){k(t,"horizontal")}),s.bind("mousedown",function(t){M(t,"horizontal")}),s.bind("dragstart",function(t){t.preventDefault()}),c.bind("mousemove",function(t){k(t,"horizontal")}),c.bind("click",function(t){k(t,"horizontal")}),c.bind("click",function(t){Y(t,"horizontal")}),h.remove(),o.append(n),n.append(h),e.append(o),v.appendTo){var i=t(v.appendTo);i.append(a),i.append(r),i.append(c),i.append(s)}else o.append(a),o.append(r),o.append(c),o.append(s);window.MutationObserver?(l=new MutationObserver(b),l.observe(n[0],{subtree:!0,attributes:!0,childList:!0,characterData:!0})):h.bind("DOMSubtreeModified",b),t(window).bind("resize",b),w()};return O(),t.extend(this,{update:w,destroy:z})}}(jQuery);