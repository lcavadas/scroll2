/*!
 * jQuery Plugin for scrollbars
 * usage of the scrollTo function requires easing - https://github.com/lcavadas/easing
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(t){t.fn.scroll2=function(i){var e,o,n,a,r,c,s,l,h,d,g,u,p=t(this),v={},f={},m={},b={},w=0,z=0,x={},E=t.extend(!0,{size:7,railColor:"#aaa",barColor:"#000",timeout:1e3,container:{width:"",height:""},appendTo:void 0,vertical:{active:!0,margin:2,top:0,bottom:0,trigger:{callback:void 0,offset:0}},horizontal:{active:!0,margin:2,left:0,right:0,trigger:{callback:void 0,offset:0}}},i),T=function(){v.throttle=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-v.throttle>=500&&M()},500)},M=function(){"function"==typeof E.container.width?e.width(E.container.width()):E.container.width&&e.width(E.container.width),"function"==typeof E.container.height?e.height(E.container.height()):E.container.height&&e.height(E.container.height),h=n[0].scrollHeight-e.height(),d=n[0].scrollWidth-e.width();var t=e.height()/p.height(),i=e.width()/p.width();r.height(Math.floor(100*t)+"%"),s.width(Math.floor(100*i)+"%"),window.setTimeout(function(){r.height(Math.max(r.height()-E.vertical.top-E.vertical.bottom,2*E.size)),s.width(Math.max(s.width()-E.horizontal.left-E.horizontal.right,2*E.size))},200),p.height()<=e.height()||!E.vertical.active?(r.hide(),a.hide()):(r.show(),a.show()),p.width()<=e.width()||!E.horizontal.active?(s.hide(),c.hide()):(s.show(),c.show())},D=function(){window.MutationObserver?l.disconnect():p.unbind("DOMSubtreeModified",T),t(window).unbind("resize",T),t(document).unbind("mouseup",Y),E.appendTo&&t(E.appendTo).unbind("mousemove",P),p.remove(),o.append(p),e.remove()},y=function(t,i,e,o){("mousemove"!==i.type||i.pageX!==f[e]||i.pageY!==m[e])&&(f[e]=i.pageX,m[e]=i.pageY,t.addClass("active"),v[e]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-v[e]>=E.timeout&&(t.removeClass("active"),"function"==typeof o&&o())},E.timeout))},k=function(t,i){"horizontal"===i?(s.height(E.size+3),s.css("bottom",E.horizontal.margin+2+"px"),y(c,t,i+"rail",function(){s.css("bottom",E.horizontal.margin+"px"),s.height(E.size)})):(r.width(E.size+3),r.css("right",E.vertical.margin+2+"px"),y(a,t,i+"rail",function(){r.css("right",E.vertical.margin+"px"),r.width(E.size)}))},L=function(t){y(r,t,"verticalbar"),y(s,t,"horizontalbar")},X=function(t,i){L(t),k(t,i)},C=function(t){0>z?z=0:z>h&&(z=h),0>w?w=0:w>d&&(w=d),(n.scrollTop()!==Math.floor(z)||n.scrollLeft()!==Math.floor(w))&&(r.css("top",e.height()*z/p.height()+"px"),s.css("left",e.width()*w/p.width()+"px"),s.is(":visible")&&(n.scrollLeft(w),"function"==typeof E.horizontal.trigger.callback&&d-w<=E.horizontal.trigger.offset&&E.horizontal.trigger.callback()),r.is(":visible")&&(n.scrollTop(z),"function"==typeof E.vertical.trigger.callback&&h-z<=E.vertical.trigger.offset&&E.vertical.trigger.callback()),t.preventDefault(),t.stopPropagation())},O=function(t){return"touchstart"===t.type?(f.touch=t.originalEvent.touches[0].pageX,void(m.touch=t.originalEvent.touches[0].pageY)):("touchmove"===t.type?(f.touch&&m.touch&&(w-=t.originalEvent.touches[0].pageX-f.touch,z-=t.originalEvent.touches[0].pageY-m.touch),f.touch=t.originalEvent.touches[0].pageX,m.touch=t.originalEvent.touches[0].pageY):(w+=(t.originalEvent.deltaX||0)*x[t.originalEvent.deltaMode||WheelEvent.DOM_DELTA_PIXEL],z+=(t.originalEvent.deltaY||0)*x[t.originalEvent.deltaMode||WheelEvent.DOM_DELTA_PIXEL]),void C(t))},_=function(i,e){t(document.body).addClass("scroll2-noselect"),b[e]=!0},Y=function(){t(document.body).removeClass("scroll2-noselect"),b={}},A=function(t,i){"horizontal"===i?t.pageX-s.offset().left>0?w+=e.width():w-=e.width():t.pageY-r.offset().top>0?z+=e.height():z-=e.height(),C(t)},P=function(t){b.vertical&&m.drag?z+=p.height()*(t.pageY-m.drag)/e.height():b.horizontal&&f.drag&&(w+=p.width()*(t.pageX-f.drag)/e.width()),b.vertical||b.horizontal?(C(t),f.drag=t.pageX,m.drag=t.pageY):(f.drag=void 0,m.drag=void 0)},W=function(t,i,e,o,n,a,r,c){t+=i,E.vertical.active&&n&&(z=Math.Easing[c](t,e,n,r)),E.horizontal.active&&a&&(w=Math.Easing[c](t,o,a,r)),r>t?window.setTimeout(function(){W(t,i,e,o,n,a,r,c)},i):(z=e+n,w=o+a),C({preventDefault:function(){},stopPropagation:function(){}})},I=function(i,e,o){var n=t(i);if(0!==u||0!==g){var a=z,r=w;W(0,5,a,r,n.position().top,n.position().left,e||600,o||"easeInOutCirc")}},S=function(){if(o=p.parent(),e=t('<div class="scroll2"/>'),n=t('<div class="scroll2-content"/>'),e.bind("mousewheel touchmove touchstart wheel mousemove",function(t){L(t),"mousemove"!==t.type&&O(t)}),a=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),a.width(E.size+7),a.css("background-color",E.railColor),a.css("top","0"),a.css("right",E.vertical.margin+"px"),a.css("bottom","0"),a.css("margin-top",E.vertical.top+"px"),a.css("margin-bottom",E.vertical.bottom+"px"),r=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),r.width(E.size),r.css("border-radius",E.size+"px"),r.css("background-color",E.barColor),r.css("top","0"),r.css("right",E.vertical.margin+"px"),r.css("margin-top",E.vertical.top+"px"),r.css("margin-bottom",E.vertical.bottom+"px"),c=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),c.height(E.size+7),c.css("background-color",E.railColor),c.css("left","0"),c.css("bottom",E.horizontal.margin+"px"),c.css("right","0"),c.css("margin-left",E.horizontal.left+"px"),c.css("margin-right",E.horizontal.right+"px"),s=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),s.height(E.size),s.css("border-radius",E.size+"px"),s.css("background-color",E.barColor),s.css("left","0"),s.css("bottom",E.horizontal.margin+"px"),s.css("margin-left",E.horizontal.left+"px"),s.css("margin-right",E.horizontal.right+"px"),x[WheelEvent.DOM_DELTA_PIXEL]=1,x[WheelEvent.DOM_DELTA_LINE]=+p.css("font-size").substring(0,p.css("font-size").length-2),x[WheelEvent.DOM_DELTA_PAGE]=e.height(),t(document).bind("mouseup",Y),E.appendTo?t(E.appendTo).bind("mousemove",P):e.bind("mousemove",P),r.bind("mousemove",function(t){X(t,"vertical")}),r.bind("mousedown",function(t){_(t,"vertical")}),r.bind("dragstart",function(t){t.preventDefault()}),a.bind("mousemove",function(t){X(t,"vertical")}),a.bind("click",function(t){X(t,"vertical")}),a.bind("click",function(t){A(t,"vertical")}),s.bind("mousemove",function(t){X(t,"horizontal")}),s.bind("mousedown",function(t){_(t,"horizontal")}),s.bind("dragstart",function(t){t.preventDefault()}),c.bind("mousemove",function(t){X(t,"horizontal")}),c.bind("click",function(t){X(t,"horizontal")}),c.bind("click",function(t){A(t,"horizontal")}),p.remove(),e.append(n),n.append(p),o.append(e),E.appendTo){var i=t(E.appendTo);i.append(a),i.append(r),i.append(c),i.append(s)}else e.append(a),e.append(r),e.append(c),e.append(s);window.MutationObserver?(l=new MutationObserver(T),l.observe(n[0],{subtree:!0,attributes:!0,childList:!0,characterData:!0})):p.bind("DOMSubtreeModified",T),t(window).bind("resize",T),M()};return S(),t.extend(this,{update:M,scrollTo:I,destroy:D})}}(jQuery);