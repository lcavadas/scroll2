/*!
 * jQuery Plugin for scrollbars
 * usage of the scrollTo function requires easing - https://github.com/lcavadas/easing
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(t){t.fn.scroll2=function(i){var o,e,n,a,r,c,s,l,h,d,u,g,p=t(this),f={},v={},m={},b={},w=0,z=0,x=t.extend(!0,{size:7,railColor:"#aaa",barColor:"#000",timeout:1e3,container:{width:"",height:""},appendTo:void 0,vertical:{active:!0,margin:2,top:0,bottom:0,trigger:{callback:void 0,offset:0}},horizontal:{active:!0,margin:2,left:0,right:0,trigger:{callback:void 0,offset:0}}},i),T=function(){f.throttle=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-f.throttle>=500&&y()},500)},y=function(){"function"==typeof x.container.width?o.width(x.container.width()):x.container.width&&o.width(x.container.width),"function"==typeof x.container.height?o.height(x.container.height()):x.container.height&&o.height(x.container.height);var t=o.height()/p.height(),i=o.width()/p.width();r.height(Math.floor(100*t)+"%"),s.width(Math.floor(100*i)+"%"),window.setTimeout(function(){r.height(r.height()||2*x.size),s.width(s.width()||2*x.size)},200),p.height()<=o.height()||!x.vertical.active?(r.hide(),a.hide()):(r.show(),a.show()),p.width()<=o.width()||!x.horizontal.active?(s.hide(),c.hide()):(s.show(),c.show())},k=function(){window.MutationObserver?l.disconnect():p.unbind("DOMSubtreeModified",T),t(window).unbind("resize",T),t(document).unbind("mouseup",L),x.appendTo&&t(x.appendTo).unbind("mousemove",j),p.remove(),e.append(p),o.remove()},M=function(t,i,o,e){("mousemove"!==i.type||i.pageX!==v[o]||i.pageY!==m[o])&&(v[o]=i.pageX,m[o]=i.pageY,t.addClass("active"),f[o]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-f[o]>=x.timeout&&(t.removeClass("active"),"function"==typeof e&&e())},x.timeout))},C=function(t,i){"horizontal"===i?(s.height(x.size+3),s.css("bottom",x.horizontal.margin+2+"px"),M(c,t,i+"rail",function(){s.css("bottom",x.horizontal.margin+"px"),s.height(x.size)})):(r.width(x.size+3),r.css("right",x.vertical.margin+2+"px"),M(a,t,i+"rail",function(){r.css("right",x.vertical.margin+"px"),r.width(x.size)}))},D=function(t){M(r,t,"verticalbar"),M(s,t,"horizontalbar")},E=function(t,i){D(t),C(t,i)},X=function(t){0>z?z=0:z>h&&(z=h),0>w?w=0:w>d&&(w=d),(n.scrollTop()!==Math.floor(z)||n.scrollLeft()!==Math.floor(w))&&(r.css("top",o.height()*z/p.height()+"px"),s.css("left",o.width()*w/p.width()+"px"),s.is(":visible")&&(n.scrollLeft(w),"function"==typeof x.horizontal.trigger.callback&&d-w<=x.horizontal.trigger.offset&&x.horizontal.trigger.callback()),r.is(":visible")&&(n.scrollTop(z),"function"==typeof x.vertical.trigger.callback&&h-z<=x.vertical.trigger.offset&&x.vertical.trigger.callback()),t.preventDefault())},Y=function(t){return"touchstart"===t.type?(v.touch=t.originalEvent.touches[0].pageX,void(m.touch=t.originalEvent.touches[0].pageY)):("touchmove"===t.type?(v.touch&&m.touch&&(w-=t.originalEvent.touches[0].pageX-v.touch,z-=t.originalEvent.touches[0].pageY-m.touch),v.touch=t.originalEvent.touches[0].pageX,m.touch=t.originalEvent.touches[0].pageY):(w+=t.originalEvent.deltaX||0,z+=t.originalEvent.deltaY||0),void X(t))},O=function(i,o){t(document.body).addClass("scroll2-noselect"),b[o]=!0},L=function(){t(document.body).removeClass("scroll2-noselect"),b={}},S=function(t,i){"horizontal"===i?t.pageX-s.offset().left>0?w+=o.width():w-=o.width():t.pageY-r.offset().top>0?z+=o.height():z-=o.height(),X(t)},j=function(t){b.vertical&&m.drag?z+=p.height()*(t.pageY-m.drag)/o.height():b.horizontal&&v.drag&&(w+=p.width()*(t.pageX-v.drag)/o.width()),b.vertical||b.horizontal?(X(t),v.drag=t.pageX,m.drag=t.pageY):(v.drag=void 0,m.drag=void 0)},H=function(t,i,o,e,n,a,r,c){t+=i,z=Math.Easing[c](t,o,n,r),w=Math.Easing[c](t,e,a,r),r>t?window.setTimeout(function(){H(t,i,o,e,n,a,r,c)},i):(z=n,w=a),X({preventDefault:function(){}})},I=function(i,o,e){var n=t(i);if(0!==g||0!==u){var a=z,r=w;H(0,5,a,r,n.position().top,n.position().left,o||600,e||"easeInOutCirc")}},P=function(){if(e=p.parent(),o=t('<div class="scroll2"/>'),n=t('<div class="scroll2-content"/>'),o.bind("mousewheel touchmove touchstart wheel mousemove",function(t){D(t),"mousemove"!==t.type?Y(t):t.stopPropagation()}),a=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),a.width(x.size+7),a.css("background-color",x.railColor),a.css("top","0"),a.css("right",x.vertical.margin+"px"),a.css("bottom","0"),a.css("margin-top",x.vertical.top+"px"),a.css("margin-bottom",x.vertical.bottom+"px"),r=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),r.width(x.size),r.css("border-radius",x.size+"px"),r.css("background-color",x.barColor),r.css("top","0"),r.css("right",x.vertical.margin+"px"),r.css("margin-top",x.vertical.top+"px"),r.css("margin-bottom",x.vertical.bottom+"px"),c=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),c.height(x.size+7),c.css("background-color",x.railColor),c.css("left","0"),c.css("bottom",x.horizontal.margin+"px"),c.css("right","0"),c.css("margin-left",x.horizontal.left+"px"),c.css("margin-right",x.horizontal.right+"px"),s=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),s.height(x.size),s.css("border-radius",x.size+"px"),s.css("background-color",x.barColor),s.css("left","0"),s.css("bottom",x.horizontal.margin+"px"),s.css("margin-left",x.horizontal.left+"px"),s.css("margin-right",x.horizontal.right+"px"),t(document).bind("mouseup",L),x.appendTo?t(x.appendTo).bind("mousemove",j):o.bind("mousemove",j),r.bind("mousemove",function(t){E(t,"vertical")}),r.bind("mousedown",function(t){O(t,"vertical")}),r.bind("dragstart",function(t){t.preventDefault()}),a.bind("mousemove",function(t){E(t,"vertical")}),a.bind("click",function(t){E(t,"vertical")}),a.bind("click",function(t){S(t,"vertical")}),s.bind("mousemove",function(t){E(t,"horizontal")}),s.bind("mousedown",function(t){O(t,"horizontal")}),s.bind("dragstart",function(t){t.preventDefault()}),c.bind("mousemove",function(t){E(t,"horizontal")}),c.bind("click",function(t){E(t,"horizontal")}),c.bind("click",function(t){S(t,"horizontal")}),p.remove(),o.append(n),n.append(p),e.append(o),x.appendTo){var i=t(x.appendTo);i.append(a),i.append(r),i.append(c),i.append(s)}else o.append(a),o.append(r),o.append(c),o.append(s);window.MutationObserver?(l=new MutationObserver(T),l.observe(n[0],{subtree:!0,attributes:!0,childList:!0,characterData:!0})):p.bind("DOMSubtreeModified",T),t(window).bind("resize",T),h=n[0].scrollHeight-o.height(),d=n[0].scrollWidth-o.width(),y()};return P(),t.extend(this,{update:y,scrollTo:I,destroy:k})}}(jQuery);