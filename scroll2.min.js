/*!
 * jQuery Plugin for scrollbars
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(i){i.fn.scroll2=function(t){var o,e,n,s,a,r,c,h=i(this),d=0,l=0,u={},g={},p={},f={},m=i.extend({size:7,railColor:"#aaa",barColor:"#000",marginY:2,marginX:2,timeout:1e3},t),b=function(){var i=o.height()/h.height(),t=o.width()/h.width();a.height(Math.floor(100*i)+"%"),c.width(Math.floor(100*t)+"%"),window.setTimeout(function(){a.height(a.height()),c.width(c.width())},200),h.height()===o.height()?(a.hide(),s.hide()):(a.show(),s.show()),h.width()===o.width()?(c.hide(),r.hide()):(c.show(),r.show())},v=function(){h.unbind("DOMSubtreeModified",b),i(document).unbind("mouseup",C),h.remove(),e.append(h),o.remove()},w=function(i,t,o,e){("mousemove"!==t.type||t.pageX!==g[o]||t.pageY!==p[o])&&(g[o]=t.pageX,p[o]=t.pageY,i.addClass("active"),u[o]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u[o]>=m.timeout&&(i.removeClass("active"),"function"==typeof e&&e())},m.timeout))},z=function(i,t){"horizontal"===t?(c.height(m.size+3),c.css("bottom",m.marginX+2+"px"),w(r,i,t+"rail",function(){c.css("bottom",m.marginX+"px"),c.height(m.size)})):(a.width(m.size+3),a.css("right",m.marginY+2+"px"),w(s,i,t+"rail",function(){a.css("right",m.marginY+"px"),a.width(m.size)}))},x=function(i){w(a,i,"verticalbar"),w(c,i,"horizontalbar")},X=function(i,t){x(i),z(i,t)},Y=function(i){0>l?l=0:l>h.height()-o.height()&&(l=h.height()-o.height()),0>d?d=0:d>h.width()-o.width()&&(d=h.width()-o.width()),(n.scrollTop()!==l||n.scrollLeft()!==d)&&(i.preventDefault(),a.css("top",o.height()*l/h.height()+"px"),c.css("left",o.width()*d/h.width()+"px"),n.scrollTop(l),n.scrollLeft(d))},y=function(i){"touchmove"===i.type?(g.touch&&p.touch&&(d-=i.originalEvent.touches[0].pageX-g.touch,l-=i.originalEvent.touches[0].pageY-p.touch),g.touch=i.originalEvent.touches[0].pageX,p.touch=i.originalEvent.touches[0].pageY):(d+=i.originalEvent.deltaX,l+=i.originalEvent.deltaY),Y(i)},k=function(i,t){f[t]=!0},C=function(){f={}},D=function(i,t){"horizontal"===t?i.pageX-c.offset().left>0?d+=o.width():d-=o.width():i.pageY-a.offset().top>0?l+=o.height():l-=o.height(),Y(i)},E=function(i){f.vertical&&p.drag?l+=h.height()*(i.pageY-p.drag)/o.height():f.horizontal&&g.drag&&(d+=h.width()*(i.pageX-g.drag)/o.width()),f.vertical||f.horizontal?(Y(i),g.drag=i.pageX,p.drag=i.pageY):(g.drag=void 0,p.drag=void 0)},M=function(){e=h.parent(),o=i('<div class="scroll2"/>'),o.bind("mousewheel touchmove wheel mousemove",x),o.bind("mousewheel touchmove wheel",y),n=i('<div class="scroll2-content"/>'),s=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),s.width(m.size+7),s.css("background-color",m.railColor),s.css("top","0"),s.css("right",m.marginY+"px"),s.css("bottom","0"),a=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),a.width(m.size),a.css("border-radius",m.size+"px"),a.css("background-color",m.barColor),a.css("top","0"),a.css("right",m.marginY+"px"),r=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),r.height(m.size+7),r.css("background-color",m.railColor),r.css("left","0"),r.css("bottom",m.marginX+"px"),r.css("right","0"),c=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),c.height(m.size),c.css("border-radius",m.size+"px"),c.css("background-color",m.barColor),c.css("left","0"),c.css("bottom",m.marginX+"px"),i(document).bind("mouseup",C),o.bind("mousemove",E),a.bind("mousemove",function(i){X(i,"vertical")}),a.bind("mousedown",function(i){k(i,"vertical")}),a.bind("dragstart",function(i){i.preventDefault()}),s.bind("mousemove",function(i){X(i,"vertical")}),s.bind("click",function(i){X(i,"vertical")}),s.bind("click",function(i){D(i,"vertical")}),c.bind("mousemove",function(i){X(i,"horizontal")}),c.bind("mousedown",function(i){k(i,"horizontal")}),c.bind("dragstart",function(i){i.preventDefault()}),r.bind("mousemove",function(i){X(i,"horizontal")}),r.bind("click",function(i){X(i,"horizontal")}),r.bind("click",function(i){D(i,"horizontal")}),h.remove(),o.append(n),o.append(s),o.append(a),o.append(r),o.append(c),n.append(h),e.append(o),h.bind("DOMSubtreeModified",b),b()};return M(),i.extend(this,{update:b,destroy:v})}}(jQuery);