/*!
 * jQuery Plugin for scrollbars
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(i){i.fn.scroll2=function(t){var e,o,n,a,r,c,s,l=i(this),h=0,d=0,u={},g={},p={},f={},v=i.extend(!0,{size:7,railColor:"#aaa",barColor:"#000",timeout:1e3,container:{width:"",height:""},appendTo:void 0,vertical:{active:!0,margin:2,trigger:{callback:void 0,offset:0}},horizontal:{active:!0,margin:2,trigger:{callback:void 0,offset:0}}},t),m=function(){u.throttle=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u.throttle>=500&&b()},500)},b=function(){"function"==typeof v.container.width&&e.width(v.container.width()),"function"==typeof v.container.height&&e.height(v.container.height());var i=e.height()/l.height(),t=e.width()/l.width();r.height(Math.floor(100*i)+"%"),s.width(Math.floor(100*t)+"%"),window.setTimeout(function(){r.height(r.height()),s.width(s.width())},200),l.height()<=e.height()||!v.vertical.active?(r.hide(),a.hide()):(r.show(),a.show()),l.width()<=e.width()||!v.horizontal.active?(s.hide(),c.hide()):(s.show(),c.show())},w=function(){l.unbind("DOMSubtreeModified",m),i(window).unbind("resize",m),i(document).unbind("mouseup",X),v.appendTo&&i(v.appendTo).unbind("mousemove",E),l.remove(),o.append(l),e.remove()},z=function(i,t,e,o){("mousemove"!==t.type||t.pageX!==g[e]||t.pageY!==p[e])&&(g[e]=t.pageX,p[e]=t.pageY,i.addClass("active"),u[e]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u[e]>=v.timeout&&(i.removeClass("active"),"function"==typeof o&&o())},v.timeout))},x=function(i,t){"horizontal"===t?(s.height(v.size+3),s.css("bottom",v.horizontal.margin+2+"px"),z(c,i,t+"rail",function(){s.css("bottom",v.horizontal.margin+"px"),s.height(v.size)})):(r.width(v.size+3),r.css("right",v.vertical.margin+2+"px"),z(a,i,t+"rail",function(){r.css("right",v.vertical.margin+"px"),r.width(v.size)}))},T=function(i){z(r,i,"verticalbar"),z(s,i,"horizontalbar")},y=function(i,t){T(i),x(i,t)},k=function(i){if(0>d?d=0:d>l.height()-e.height()&&(d=l.height()-e.height()),0>h?h=0:h>l.width()-e.width()&&(h=l.width()-e.width()),n.scrollTop()!==d||n.scrollLeft()!==h){if(i.preventDefault(),r.css("top",e.height()*d/l.height()+"px"),s.css("left",e.width()*h/l.width()+"px"),s.is(":visible")&&(n.scrollLeft(h),"function"==typeof v.horizontal.trigger.callback)){var t=n[0].scrollWidth-e.width();t-h<=v.horizontal.trigger.offset&&v.horizontal.trigger.callback()}if(r.is(":visible")&&(n.scrollTop(d),"function"==typeof v.vertical.trigger.callback)){var t=n[0].scrollHeight-e.height();t-d<=v.vertical.trigger.offset&&v.vertical.trigger.callback()}}},C=function(i){"touchmove"===i.type?(g.touch&&p.touch&&(h-=i.originalEvent.touches[0].pageX-g.touch,d-=i.originalEvent.touches[0].pageY-p.touch),g.touch=i.originalEvent.touches[0].pageX,p.touch=i.originalEvent.touches[0].pageY):(h+=i.originalEvent.deltaX||0,d+=i.originalEvent.deltaY||0),k(i)},D=function(t,e){i(document.body).addClass("scroll2-noselect"),f[e]=!0},X=function(){i(document.body).removeClass("scroll2-noselect"),f={}},Y=function(i,t){"horizontal"===t?i.pageX-s.offset().left>0?h+=e.width():h-=e.width():i.pageY-r.offset().top>0?d+=e.height():d-=e.height(),k(i)},E=function(i){f.vertical&&p.drag?d+=l.height()*(i.pageY-p.drag)/e.height():f.horizontal&&g.drag&&(h+=l.width()*(i.pageX-g.drag)/e.width()),f.vertical||f.horizontal?(k(i),g.drag=i.pageX,p.drag=i.pageY):(g.drag=void 0,p.drag=void 0)},M=function(){if(o=l.parent(),e=i('<div class="scroll2"/>'),n=i('<div class="scroll2-content"/>'),e.bind("mousewheel touchmove wheel mousemove",T),e.bind("mousewheel touchmove wheel",C),a=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),a.width(v.size+7),a.css("background-color",v.railColor),a.css("top","0"),a.css("right",v.vertical.margin+"px"),a.css("bottom","0"),r=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),r.width(v.size),r.css("border-radius",v.size+"px"),r.css("background-color",v.barColor),r.css("top","0"),r.css("right",v.vertical.margin+"px"),c=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),c.height(v.size+7),c.css("background-color",v.railColor),c.css("left","0"),c.css("bottom",v.horizontal.margin+"px"),c.css("right","0"),s=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),s.height(v.size),s.css("border-radius",v.size+"px"),s.css("background-color",v.barColor),s.css("left","0"),s.css("bottom",v.horizontal.margin+"px"),i(document).bind("mouseup",X),v.appendTo?i(v.appendTo).bind("mousemove",E):e.bind("mousemove",E),r.bind("mousemove",function(i){y(i,"vertical")}),r.bind("mousedown",function(i){D(i,"vertical")}),r.bind("dragstart",function(i){i.preventDefault()}),a.bind("mousemove",function(i){y(i,"vertical")}),a.bind("click",function(i){y(i,"vertical")}),a.bind("click",function(i){Y(i,"vertical")}),s.bind("mousemove",function(i){y(i,"horizontal")}),s.bind("mousedown",function(i){D(i,"horizontal")}),s.bind("dragstart",function(i){i.preventDefault()}),c.bind("mousemove",function(i){y(i,"horizontal")}),c.bind("click",function(i){y(i,"horizontal")}),c.bind("click",function(i){Y(i,"horizontal")}),l.remove(),e.append(n),n.append(l),o.append(e),v.appendTo){var t=i(v.appendTo);t.append(a),t.append(r),t.append(c),t.append(s)}else e.append(a),e.append(r),e.append(c),e.append(s);l.bind("DOMSubtreeModified",m),i(window).bind("resize",m),b()};return M(),i.extend(this,{update:b,destroy:w})}}(jQuery);