/*!
 * jQuery Plugin for scrollbars
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(t){t.fn.scroll2=function(i){var e,o,n,a,r,s,c,l,h=t(this),d=0,g=0,u={},p={},f={},v={},m=t.extend(!0,{size:7,railColor:"#aaa",barColor:"#000",timeout:1e3,container:{width:"",height:""},appendTo:void 0,vertical:{active:!0,margin:2,top:0,bottom:0,trigger:{callback:void 0,offset:0}},horizontal:{active:!0,margin:2,left:0,right:0,trigger:{callback:void 0,offset:0}}},i),b=function(){u.throttle=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u.throttle>=500&&w()},500)},w=function(){"function"==typeof m.container.width&&e.width(m.container.width()),"function"==typeof m.container.height&&e.height(m.container.height());var t=e.height()/h.height(),i=e.width()/h.width();r.height(Math.floor(100*t)+"%"),c.width(Math.floor(100*i)+"%"),window.setTimeout(function(){r.height(r.height()||2*m.size),c.width(c.width()||2*m.size)},200),h.height()<=e.height()||!m.vertical.active?(r.hide(),a.hide()):(r.show(),a.show()),h.width()<=e.width()||!m.horizontal.active?(c.hide(),s.hide()):(c.show(),s.show())},z=function(){window.MutationObserver?l.disconnect():h.unbind("DOMSubtreeModified",b),t(window).unbind("resize",b),t(document).unbind("mouseup",X),m.appendTo&&t(m.appendTo).unbind("mousemove",E),h.remove(),o.append(h),e.remove()},x=function(t,i,e,o){("mousemove"!==i.type||i.pageX!==p[e]||i.pageY!==f[e])&&(p[e]=i.pageX,f[e]=i.pageY,t.addClass("active"),u[e]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u[e]>=m.timeout&&(t.removeClass("active"),"function"==typeof o&&o())},m.timeout))},T=function(t,i){"horizontal"===i?(c.height(m.size+3),c.css("bottom",m.horizontal.margin+2+"px"),x(s,t,i+"rail",function(){c.css("bottom",m.horizontal.margin+"px"),c.height(m.size)})):(r.width(m.size+3),r.css("right",m.vertical.margin+2+"px"),x(a,t,i+"rail",function(){r.css("right",m.vertical.margin+"px"),r.width(m.size)}))},y=function(t){x(r,t,"verticalbar"),x(c,t,"horizontalbar")},k=function(t,i){y(t),T(t,i)},C=function(t){if(0>g?g=0:g>h.height()-e.height()&&(g=h.height()-e.height()),0>d?d=0:d>h.width()-e.width()&&(d=h.width()-e.width()),n.scrollTop()!==g||n.scrollLeft()!==d){if(t.preventDefault(),r.css("top",e.height()*g/h.height()+"px"),c.css("left",e.width()*d/h.width()+"px"),c.is(":visible")&&(n.scrollLeft(d),"function"==typeof m.horizontal.trigger.callback)){var i=n[0].scrollWidth-e.width();i-d<=m.horizontal.trigger.offset&&m.horizontal.trigger.callback()}if(r.is(":visible")&&(n.scrollTop(g),"function"==typeof m.vertical.trigger.callback)){var i=n[0].scrollHeight-e.height();i-g<=m.vertical.trigger.offset&&m.vertical.trigger.callback()}}},D=function(t){"touchmove"===t.type?(p.touch&&f.touch&&(d-=t.originalEvent.touches[0].pageX-p.touch,g-=t.originalEvent.touches[0].pageY-f.touch),p.touch=t.originalEvent.touches[0].pageX,f.touch=t.originalEvent.touches[0].pageY):(d+=t.originalEvent.deltaX||0,g+=t.originalEvent.deltaY||0),C(t)},M=function(i,e){t(document.body).addClass("scroll2-noselect"),v[e]=!0},X=function(){t(document.body).removeClass("scroll2-noselect"),v={}},Y=function(t,i){"horizontal"===i?t.pageX-c.offset().left>0?d+=e.width():d-=e.width():t.pageY-r.offset().top>0?g+=e.height():g-=e.height(),C(t)},E=function(t){v.vertical&&f.drag?g+=h.height()*(t.pageY-f.drag)/e.height():v.horizontal&&p.drag&&(d+=h.width()*(t.pageX-p.drag)/e.width()),v.vertical||v.horizontal?(C(t),p.drag=t.pageX,f.drag=t.pageY):(p.drag=void 0,f.drag=void 0)},O=function(){if(o=h.parent(),e=t('<div class="scroll2"/>'),n=t('<div class="scroll2-content"/>'),e.bind("mousewheel touchmove wheel mousemove",y),e.bind("mousewheel touchmove wheel",D),a=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),a.width(m.size+7),a.css("background-color",m.railColor),a.css("top","0"),a.css("right",m.vertical.margin+"px"),a.css("bottom","0"),a.css("margin-top",m.vertical.top+"px"),a.css("margin-bottom",m.vertical.bottom+"px"),r=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),r.width(m.size),r.css("border-radius",m.size+"px"),r.css("background-color",m.barColor),r.css("top","0"),r.css("right",m.vertical.margin+"px"),r.css("margin-top",m.vertical.top+"px"),r.css("margin-bottom",m.vertical.bottom+"px"),s=t('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),s.height(m.size+7),s.css("background-color",m.railColor),s.css("left","0"),s.css("bottom",m.horizontal.margin+"px"),s.css("right","0"),s.css("margin-left",m.horizontal.left+"px"),s.css("margin-right",m.horizontal.right+"px"),c=t('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),c.height(m.size),c.css("border-radius",m.size+"px"),c.css("background-color",m.barColor),c.css("left","0"),c.css("bottom",m.horizontal.margin+"px"),c.css("margin-left",m.horizontal.left+"px"),c.css("margin-right",m.horizontal.right+"px"),t(document).bind("mouseup",X),m.appendTo?t(m.appendTo).bind("mousemove",E):e.bind("mousemove",E),r.bind("mousemove",function(t){k(t,"vertical")}),r.bind("mousedown",function(t){M(t,"vertical")}),r.bind("dragstart",function(t){t.preventDefault()}),a.bind("mousemove",function(t){k(t,"vertical")}),a.bind("click",function(t){k(t,"vertical")}),a.bind("click",function(t){Y(t,"vertical")}),c.bind("mousemove",function(t){k(t,"horizontal")}),c.bind("mousedown",function(t){M(t,"horizontal")}),c.bind("dragstart",function(t){t.preventDefault()}),s.bind("mousemove",function(t){k(t,"horizontal")}),s.bind("click",function(t){k(t,"horizontal")}),s.bind("click",function(t){Y(t,"horizontal")}),h.remove(),e.append(n),n.append(h),o.append(e),m.appendTo){var i=t(m.appendTo);i.append(a),i.append(r),i.append(s),i.append(c)}else e.append(a),e.append(r),e.append(s),e.append(c);window.MutationObserver?(l=new MutationObserver(b),l.observe(n[0],{subtree:!0,attributes:!0,childList:!0,characterData:!0})):h.bind("DOMSubtreeModified",b),t(window).bind("resize",b),w()};return O(),t.extend(this,{update:w,destroy:z})}}(jQuery);