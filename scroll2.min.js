/*!
 * jQuery Plugin for scrollbars
 *
 * @author Luis Serralheiro (https://github.com/lcavadas/scroll2)
 */
!function(i){i.fn.scroll2=function(t){var e,o,n,s,a,r,h,d=i(this),c=0,l=0,u={},g={},p={},f={},m=i.extend({size:7,railColor:"#aaa",barColor:"#000",marginY:2,marginX:0,timeout:1e3},t),b=function(){var i=e.height()/d.height(),t=e.width()/d.width();a.height(Math.floor(100*i)+"%"),a.height(a.height()),h.width(Math.floor(100*t)+"%"),h.width(h.width()),d.height()===e.height()?(a.hide(),s.hide()):(a.show(),s.show()),d.width()===e.width()?(h.hide(),r.hide()):(h.show(),r.show())},v=function(){d.unbind("DOMSubtreeModified",b),i(document).unbind("mouseup",C),d.remove(),o.append(d),e.remove()},w=function(i,t,e,o){("mousemove"!==t.type||t.pageX!==g[e]||t.pageY!==p[e])&&(g[e]=t.pageX,p[e]=t.pageY,i.addClass("active"),u[e]=(new Date).getTime(),window.setTimeout(function(){(new Date).getTime()-u[e]>=m.timeout&&(i.removeClass("active"),"function"==typeof o&&o())},m.timeout))},z=function(i,t){"horizontal"===t?(r.height(m.size+7),h.height(m.size+3),h.css("bottom",m.marginX+2+"px"),w(r,i,t+"rail",function(){h.css("bottom",m.marginX+"px"),r.height(m.size),h.height(m.size)})):(s.width(m.size+7),a.width(m.size+3),a.css("right",m.marginY+2+"px"),w(s,i,t+"rail",function(){a.css("right",m.marginY+"px"),s.width(m.size),a.width(m.size)}))},x=function(i){w(a,i,"verticalbar"),w(h,i,"horizontalbar")},X=function(i,t){x(i),z(i,t)},Y=function(i){0>l?l=0:l>d.height()-e.height()?l=d.height()-e.height():0>c?c=0:c>d.width()-e.width()?c=d.width()-e.width():i.preventDefault(),a.css("top",e.height()*l/d.height()+"px"),h.css("left",e.width()*c/d.width()+"px"),n.scrollTop(l),n.scrollLeft(c)},k=function(i){c+=i.originalEvent.deltaX,l+=i.originalEvent.deltaY,Y(i)},y=function(i,t){f[t]=!0},C=function(){f={}},D=function(i,t){"horizontal"===t?i.pageX-h.offset().left>0?c+=e.width():c-=e.width():i.pageY-a.offset().top>0?l+=e.height():l-=e.height(),Y(i)},M=function(i){f.vertical&&p.drag?l+=d.height()*(i.pageY-p.drag)/e.height():f.horizontal&&g.drag&&(c+=d.width()*(i.pageX-g.drag)/e.width()),f.vertical||f.horizontal?(Y(i),g.drag=i.pageX,p.drag=i.pageY):(g.drag=void 0,p.drag=void 0)},T=function(){o=d.parent(),e=i('<div class="scroll2"/>'),e.bind("mousewheel touchmove wheel mousemove",x),e.bind("mousewheel touchmove wheel",k),n=i('<div class="scroll2-content"/>'),s=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),s.width(m.size),s.css("background-color",m.railColor),s.css("top","0"),s.css("right",m.marginY+"px"),s.css("bottom","0"),a=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),a.width(m.size),a.css("border-radius",m.size+"px"),a.css("background-color",m.barColor),a.css("top","0"),a.css("right",m.marginY+"px"),r=i('<div class="scroll2-rail" style="position: absolute; z-index: 998"/>'),r.height(m.size),r.css("background-color",m.railColor),r.css("left","0"),r.css("bottom",m.marginX+"px"),r.css("right","0"),h=i('<div class="scroll2-bar" style="position: absolute; z-index: 999;"/>'),h.height(m.size),h.css("border-radius",m.size+"px"),h.css("background-color",m.barColor),h.css("left","0"),h.css("bottom",m.marginX+"px"),i(document).bind("mouseup",C),e.bind("mousemove",M),a.bind("mousemove",function(i){X(i,"vertical")}),a.bind("mousedown",function(i){y(i,"vertical")}),a.bind("dragstart",function(i){i.preventDefault()}),s.bind("mousemove",function(i){X(i,"vertical")}),s.bind("click",function(i){X(i,"vertical")}),s.bind("click",function(i){D(i,"vertical")}),h.bind("mousemove",function(i){X(i,"horizontal")}),h.bind("mousedown",function(i){y(i,"horizontal")}),h.bind("dragstart",function(i){i.preventDefault()}),r.bind("mousemove",function(i){X(i,"horizontal")}),r.bind("click",function(i){X(i,"horizontal")}),r.bind("click",function(i){D(i,"horizontal")}),d.remove(),e.append(n),e.append(s),e.append(a),e.append(r),e.append(h),n.append(d),o.append(e),d.bind("DOMSubtreeModified",b),b()};return T(),i.extend(this,{update:b,destroy:v})}}(jQuery);